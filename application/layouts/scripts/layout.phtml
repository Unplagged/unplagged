<?php
$sidebar = $this->layout()->sidebar;

$defaultNamespace = new Zend_Session_Namespace('Default');
$me = Zend_Registry::getInstance()->user;

$em = Zend_Registry::getInstance()->entitymanager;

$query = $em->createQuery("SELECT c.id AS value, c.alias AS label FROM Application_Model_Case c WHERE :userId MEMBER OF c.collaborators");
$query->setParameter('userId', $me->getId());
$cases = $query->getArrayResult();
?>
<?php echo $this->partial('partials/header.phtml', array('defaultNamespace'=>$defaultNamespace, 'me'=>$me, 'cases'=>$cases)); ?>
<div role="main" class="clearfix">
  <?php echo $this->partial('partials/messages.phtml', array('defaultNamespace'=>$defaultNamespace, 'flashMessages'=>$this->flashMessages)); ?>
  <!--<div class="breadcrumbs">
    <?php //echo $this->navigation()->breadcrumbs(); ?>
  </div>-->
  <h2><?php echo $this->escape($this->title); ?></h2>
  <div class="main">
    <div id="main-wrapper">
      <div <?php if(!empty($sidebar)) echo 'id="main"'; ?>>
        <?php
        // content from each view, the rest of this page is global to all views
        echo $this->layout()->content;
        ?>
      </div>
    </div>
  </div>
  <?php
  if(!empty($sidebar)){
    switch($sidebar){
      case "fragment-tools":
        echo $this->partial('partials/sidebars/fragment_tools.phtml', array("fragmentId" => $this->layout()->versionableId));
        break;
      case "page-tools":
        echo $this->partial('partials/sidebars/page_tools.phtml', array("pageId" => $this->layout()->versionableId));
        break;
      case "document-tools":
        echo $this->partial('partials/sidebars/document_tools.phtml', array("documentId" => $this->layout()->versionableId));
        break;
      default:
        echo $this->partial('partials/sidebars/default.phtml', array("cases" => $this->layout()->cases));
    }
  }
  ?>
</div>

<?php echo $this->partial('partials/footer.phtml'); ?>
</body>
</html>