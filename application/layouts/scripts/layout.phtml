<?php

$sidebar = $this->layout()->sidebar;

$defaultNamespace = new Zend_Session_Namespace('Default');
$em = Zend_Registry::getInstance()->entitymanager;
if($defaultNamespace->userId){
  $me = $em->getRepository('Application_Model_User')->findOneById($defaultNamespace->userId);
}else{
  $me = null;
}

// had to remove function because it somehow was included twice here
$qb = $em->createQueryBuilder();
$qb->add('select', "c.id AS value, c.alias AS label")
    ->add('from', 'Application_Model_Case c');

$dbresults = $qb->getQuery()->getResult();
$results = array();

foreach($dbresults as $key=>$value){
  $results[] = $value;
}

$cases = $results;
?>
<?php echo $this->partial('partials/header.phtml', array('defaultNamespace'=>$defaultNamespace, 'me'=>$me, 'cases'=>$cases)); ?>
<div role="main" class="clearfix show-contextmenu">
  <?php echo $this->partial('partials/messages.phtml', array('defaultNamespace'=>$defaultNamespace, 'flashMessages'=>$this->flashMessages)); ?>
  <!--<div class="breadcrumbs">
    <?php //echo $this->navigation()->breadcrumbs(); ?>
  </div>-->
  <h2><?php echo $this->escape($this->title); ?></h2>
  <div class="main">
    <div id="main-wrapper">
      <div <?php if(!empty($sidebar)) echo "id=\"main\""; ?>>
        <?php
        // content from each view, the rest of this page is global to all views
        echo $this->layout()->content;
        ?>
      </div>
    </div>
  </div>
  <?php
  if(!empty($sidebar)){
    switch($sidebar){
      case "fragment-tools":
        echo $this->partial('partials/sidebars/fragment_tools.phtml', array("fragmentId" => $this->layout()->versionableId));
        break;
      case "page-tools":
        echo $this->partial('partials/sidebars/page_tools.phtml', array("pageId" => $this->layout()->versionableId));
        break;
      case "document-tools":
        echo $this->partial('partials/sidebars/document_tools.phtml', array("documentId" => $this->layout()->versionableId));
        break;
      default:
        echo $this->partial('partials/sidebars/default.phtml');
    }
  } //echo $partial;
  ?>
</div>

<?php echo $this->partial('partials/footer.phtml'); ?>
</body>
</html>